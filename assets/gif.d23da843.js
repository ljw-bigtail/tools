var X=Object.defineProperty;var Z=(g,w,c)=>w in g?X(g,w,{enumerable:!0,configurable:!0,writable:!0,value:c}):g[w]=c;var B=(g,w,c)=>(Z(g,typeof w!="symbol"?w+"":w,c),c);import{_ as G,d as q,r as C,o as Y,g as ee,a as m,h as y,i as L,v as U,j as R,p as H,e as J,k as N,c as te,w as k,b as ne,n as ie,l as re,f as se}from"./plugin-vue_export-helper.d1c32b7f.js";import{c as A,F as V,S as ae,L as oe,T as $,G as le,a as ue,b as he}from"./Line.de871c71.js";var K={exports:{}};(function(g,w){(function(c){g.exports=c()})(function(){return function c(_,b,o){function i(d,t){if(!b[d]){if(!_[d]){var s=typeof A=="function"&&A;if(!t&&s)return s(d,!0);if(l)return l(d,!0);var n=new Error("Cannot find module '"+d+"'");throw n.code="MODULE_NOT_FOUND",n}var a=b[d]={exports:{}};_[d][0].call(a.exports,function(v){var f=_[d][1][v];return i(f||v)},a,a.exports,c,_,b,o)}return b[d].exports}for(var l=typeof A=="function"&&A,h=0;h<o.length;h++)i(o[h]);return i}({1:[function(c,_,b){function o(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}_.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.prototype.setMaxListeners=function(t){if(!l(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},o.prototype.emit=function(t){var s,n,a,v,f,e;if(this._events||(this._events={}),t==="error"&&(!this._events.error||h(this._events.error)&&!this._events.error.length)){if(s=arguments[1],s instanceof Error)throw s;var r=new Error('Uncaught, unspecified "error" event. ('+s+")");throw r.context=s,r}if(n=this._events[t],d(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:v=Array.prototype.slice.call(arguments,1),n.apply(this,v)}else if(h(n))for(v=Array.prototype.slice.call(arguments,1),e=n.slice(),a=e.length,f=0;f<a;f++)e[f].apply(this,v);return!0},o.prototype.addListener=function(t,s){var n;if(!i(s))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,i(s.listener)?s.listener:s),this._events[t]?h(this._events[t])?this._events[t].push(s):this._events[t]=[this._events[t],s]:this._events[t]=s,h(this._events[t])&&!this._events[t].warned&&(d(this._maxListeners)?n=o.defaultMaxListeners:n=this._maxListeners,n&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),typeof console.trace=="function"&&console.trace())),this},o.prototype.on=o.prototype.addListener,o.prototype.once=function(t,s){if(!i(s))throw TypeError("listener must be a function");var n=!1;function a(){this.removeListener(t,a),n||(n=!0,s.apply(this,arguments))}return a.listener=s,this.on(t,a),this},o.prototype.removeListener=function(t,s){var n,a,v,f;if(!i(s))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],v=n.length,a=-1,n===s||i(n.listener)&&n.listener===s)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,s);else if(h(n)){for(f=v;f-- >0;)if(n[f]===s||n[f].listener&&n[f].listener===s){a=f;break}if(a<0)return this;n.length===1?(n.length=0,delete this._events[t]):n.splice(a,1),this._events.removeListener&&this.emit("removeListener",t,s)}return this},o.prototype.removeAllListeners=function(t){var s,n;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[t]&&delete this._events[t],this;if(arguments.length===0){for(s in this._events)s!=="removeListener"&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],i(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},o.prototype.listeners=function(t){var s;return!this._events||!this._events[t]?s=[]:i(this._events[t])?s=[this._events[t]]:s=this._events[t].slice(),s},o.prototype.listenerCount=function(t){if(this._events){var s=this._events[t];if(i(s))return 1;if(s)return s.length}return 0},o.listenerCount=function(t,s){return t.listenerCount(s)};function i(t){return typeof t=="function"}function l(t){return typeof t=="number"}function h(t){return typeof t=="object"&&t!==null}function d(t){return t===void 0}},{}],2:[function(c,_,b){var o,i,l,h,d;d=navigator.userAgent.toLowerCase(),h=navigator.platform.toLowerCase(),o=d.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],l=o[1]==="ie"&&document.documentMode,i={name:o[1]==="version"?o[3]:o[1],version:l||parseFloat(o[1]==="opera"&&o[4]?o[4]:o[2]),platform:{name:d.match(/ip(?:ad|od|hone)/)?"ios":(d.match(/(?:webos|android)/)||h.match(/mac|win|linux/)||["other"])[0]}},i[i.name]=!0,i[i.name+parseInt(i.version,10)]=!0,i.platform[i.platform.name]=!0,_.exports=i},{}],3:[function(c,_,b){var o,i,l,h=function(n,a){for(var v in a)d.call(a,v)&&(n[v]=a[v]);function f(){this.constructor=n}return f.prototype=a.prototype,n.prototype=new f,n.__super__=a.prototype,n},d={}.hasOwnProperty,t=[].indexOf||function(n){for(var a=0,v=this.length;a<v;a++)if(a in this&&this[a]===n)return a;return-1},s=[].slice;o=c("events").EventEmitter,l=c("./browser.coffee"),i=function(n){var a,v;h(f,n),a={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},v={delay:500,copy:!1};function f(e){var r,u,p;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(e);for(u in a)p=a[u],(r=this.options)[u]==null&&(r[u]=p)}return f.prototype.setOption=function(e,r){if(this.options[e]=r,this._canvas!=null&&(e==="width"||e==="height"))return this._canvas[e]=r},f.prototype.setOptions=function(e){var r,u,p;u=[];for(r in e)!d.call(e,r)||(p=e[r],u.push(this.setOption(r,p)));return u},f.prototype.addFrame=function(e,r){var u,p;r==null&&(r={}),u={},u.transparent=this.options.transparent;for(p in v)u[p]=r[p]||v[p];if(this.options.width==null&&this.setOption("width",e.width),this.options.height==null&&this.setOption("height",e.height),typeof ImageData!="undefined"&&ImageData!==null&&e instanceof ImageData)u.data=e.data;else if(typeof CanvasRenderingContext2D!="undefined"&&CanvasRenderingContext2D!==null&&e instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext!="undefined"&&WebGLRenderingContext!==null&&e instanceof WebGLRenderingContext)r.copy?u.data=this.getContextData(e):u.context=e;else if(e.childNodes!=null)r.copy?u.data=this.getImageData(e):u.image=e;else throw new Error("Invalid image");return this.frames.push(u)},f.prototype.render=function(){var e,r,u;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var p,F,x;for(x=[],p=0,F=this.frames.length;0<=F?p<F:p>F;0<=F?++p:--p)x.push(null);return x}.call(this),r=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(e=0,u=r;0<=u?e<u:e>u;0<=u?++e:--e)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},f.prototype.abort=function(){for(var e;e=this.activeWorkers.shift(),e!=null;)this.log("killing active worker"),e.terminate();return this.running=!1,this.emit("abort")},f.prototype.spawnWorkers=function(){var e,r,u;return e=Math.min(this.options.workers,this.frames.length),function(){u=[];for(var p=r=this.freeWorkers.length;r<=e?p<e:p>e;r<=e?p++:p--)u.push(p);return u}.apply(this).forEach(function(p){return function(F){var x;return p.log("spawning worker "+F),x=new Worker(p.options.workerScript),x.onmessage=function(E){return p.activeWorkers.splice(p.activeWorkers.indexOf(x),1),p.freeWorkers.push(x),p.frameFinished(E.data)},p.freeWorkers.push(x)}}(this)),e},f.prototype.frameFinished=function(e){var r,u;if(this.log("frame "+e.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[e.index]=e,this.options.globalPalette===!0&&(this.options.globalPalette=e.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(r=1,u=this.freeWorkers.length;1<=u?r<u:r>u;1<=u?++r:--r)this.renderNextFrame();return t.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},f.prototype.finishRendering=function(){var e,r,u,p,F,x,E,P,M,z,T,D,j,O,S,W;for(P=0,O=this.imageParts,F=0,M=O.length;F<M;F++)r=O[F],P+=(r.data.length-1)*r.pageSize+r.cursor;for(P+=r.pageSize-r.cursor,this.log("rendering finished - filesize "+Math.round(P/1e3)+"kb"),e=new Uint8Array(P),D=0,S=this.imageParts,x=0,z=S.length;x<z;x++)for(r=S[x],W=r.data,u=E=0,T=W.length;E<T;u=++E)j=W[u],e.set(j,D),u===r.data.length-1?D+=r.cursor:D+=r.pageSize;return p=new Blob([e],{type:"image/gif"}),this.emit("finished",p,e)},f.prototype.renderNextFrame=function(){var e,r,u;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return e=this.frames[this.nextFrame++],u=this.freeWorkers.shift(),r=this.getTask(e),this.log("starting frame "+(r.index+1)+" of "+this.frames.length),this.activeWorkers.push(u),u.postMessage(r)},f.prototype.getContextData=function(e){return e.getImageData(0,0,this.options.width,this.options.height).data},f.prototype.getImageData=function(e){var r;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),r=this._canvas.getContext("2d"),r.setFill=this.options.background,r.fillRect(0,0,this.options.width,this.options.height),r.drawImage(e,0,0),this.getContextData(r)},f.prototype.getTask=function(e){var r,u;if(r=this.frames.indexOf(e),u={index:r,last:r===this.frames.length-1,delay:e.delay,transparent:e.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:l.name==="chrome"},e.data!=null)u.data=e.data;else if(e.context!=null)u.data=this.getContextData(e.context);else if(e.image!=null)u.data=this.getImageData(e.image);else throw new Error("Invalid frame");return u},f.prototype.log=function(){var e;if(e=1<=arguments.length?s.call(arguments,0):[],!!this.options.debug)return console.log.apply(console,e)},f}(o),_.exports=i},{"./browser.coffee":2,events:1}]},{},[3])(3)})})(K);var fe=K.exports;class de{constructor(){B(this,"options");B(this,"blob");this.blob=null,this.options={width:900,height:1600,repeat:0,delay:750,background:"#FFFFFF",rule:3}}setOpt(w){return this.options=Object.assign(this.options,w),this}_loadPaint(w){const c=this.options;return Promise.all(w.map(_=>new Promise((b,o)=>{const i=document.createElement("canvas");i.width=c.width,i.height=c.height;const l=new Image;l.src=window.URL.createObjectURL(_.file),l.onload=function(h){b({canvas:i,img:l})}})))}_paintFrame(w){const c=this.options,{img:_,canvas:b}=w,o=b.getContext("2d");if(!b||!_||!o)return;o.fillStyle=c.background,o.fillRect(0,0,b.width,b.height);const{width:i,height:l}=_,{width:h,height:d}=b,t=l/i;if(c.rule==1)o.drawImage(_,0,0,h,d);else if(c.rule==2){const s=d>=l?d/l:1,n=h>=i?h/i:1,a=Math.min(s,n);let v=[0,0];a==s?v=[(h-i*a)/2,0]:v=[0,(d-l*a)/2];const f=[i*a,i*a*t];o.drawImage(_,...v,...f)}else if(c.rule==3){const s=d>=l?d/l:1,n=h>=i?h/i:1,a=Math.max(s,n);let v=[0,0];a==s?v=[(h-i*a)/2,0]:v=[0,(d-l*a)/2];const f=[i*a,i*a*t];o.drawImage(_,...v,...f)}return b}toBlob(w=[]){const c=this;return new Promise((_,b)=>{w.length==0&&(this.blob=null,b("\u6570\u636E\u4E3A\u7A7A"));const o=c.options,i=new fe(Object.assign({workers:2,quality:10,repeat:0,background:"#FFFFFF",dither:!1,workerScript:"static/gif.worker.js"},o));c._loadPaint(w).then(l=>{l.forEach(h=>{const d=c._paintFrame(h);d&&i.addFrame(d,{delay:o.delay,copy:!0})})}).then(l=>{i.render()}).catch(l=>b),i.on("finished",function(l){c.blob=l,_(l)})})}toPreView(){return this.blob?URL.createObjectURL(this.blob):""}toFile(w){!this.blob||(w=="gif"?V.exports.saveAs(this.blob,"image.gif"):w=="mp4"&&V.exports.saveAs(this.blob,"video.mp4"),this.blob=null)}}const I=g=>(H("data-v-4ba5eef4"),g=g(),J(),g),ce={class:"form"},ve=I(()=>m("label",null,"\u5BBD / \u9AD8\uFF1A",-1)),pe=I(()=>m("label",{for:"rule"},"\u622A\u53D6\u89C4\u5219\uFF1A",-1)),ge=N(" \u653E\u5927 "),me=N(" \u7B49\u6BD4\u7F29\u5C0F "),be=N(" \u7B49\u6BD4\u653E\u5927 "),we=I(()=>m("label",{for:"background"},"\u80CC\u666F\u8272\uFF1A",-1)),_e=I(()=>m("label",{for:"delay"},"\u505C\u7559\u65F6\u95F4\uFF1A",-1)),xe=I(()=>m("label",{for:"repeat"},"\u91CD\u590D\u6B21\u6570\uFF1A",-1)),Fe=q({__name:"gif-canvas",props:{value:null},emits:["update:value","change"],setup(g,{emit:w}){const c=g,_=C({width:c.value.width,height:c.value.height}),b=function(i){let l=c.value;i&&(l=Object.assign(l,i)),w("update:value",l),w("change")},o=function(i){b(i)};return(i,l)=>(Y(),ee("div",ce,[m("div",null,[ve,y(ae,{value:_.value,onChange:o},null,8,["value"])]),m("div",null,[pe,m("div",null,[L(m("input",{type:"radio",name:"rule",value:1,"onUpdate:modelValue":l[0]||(l[0]=h=>g.value.rule=h),onChange:b},null,544),[[U,g.value.rule]]),ge,L(m("input",{type:"radio",name:"rule",value:2,"onUpdate:modelValue":l[1]||(l[1]=h=>g.value.rule=h),onChange:b},null,544),[[U,g.value.rule]]),me,L(m("input",{type:"radio",name:"rule",value:3,"onUpdate:modelValue":l[2]||(l[2]=h=>g.value.rule=h),onChange:b},null,544),[[U,g.value.rule]]),be])]),y(oe),m("div",null,[we,m("div",null,[L(m("input",{type:"color",name:"background","onUpdate:modelValue":l[3]||(l[3]=h=>g.value.background=h),onChange:b},null,544),[[R,g.value.background]])])]),m("div",null,[_e,m("div",null,[L(m("input",{type:"number",name:"delay",min:"0",placeholder:"\u505C\u7559\u65F6\u95F4 \u6BEB\u79D2","onUpdate:modelValue":l[4]||(l[4]=h=>g.value.delay=h),onChange:b},null,544),[[R,g.value.delay]])])]),m("div",null,[xe,m("div",null,[L(m("input",{type:"number",name:"repeat",min:"-1",placeholder:"-1 never 0 ever or number","onUpdate:modelValue":l[5]||(l[5]=h=>g.value.repeat=h),onChange:b},null,544),[[R,g.value.repeat]])])])]))}});var ye=G(Fe,[["__scopeId","data-v-4ba5eef4"]]);const Q=g=>(H("data-v-3e074d46"),g=g(),J(),g),ke=Q(()=>m("span",null,"Pic GIF",-1)),Ce=Q(()=>m("button",{class:"button C"},[m("a",{href:"./collage.html"},"Pic Collage")],-1)),Le={class:"left"},Ee={class:"btn-group center"},Pe={class:"right"},Ie=["src"],De=q({__name:"index",setup(g){const w=C([]),c=C("library"),_=C(""),b=C(),o=C({width:900,height:1600,repeat:0,delay:750,background:"#FFFFFF",rule:3}),i=C([]),l=new de,h=()=>{ie(()=>{i.value=[],_.value="",b.value.clearFile(),d("\u6E05\u7406\u6210\u529F")})},d=n=>{w.value.push({value:n,timestamp:re()})},t=function(){console.log(i.value),l.setOpt(o.value).toBlob(i.value).then(()=>{_.value=l.toPreView()}).catch(n=>{console.log(n)})},s=function(n){l.setOpt(o.value).toBlob(i.value).then(()=>{l.toFile(n)}).catch(a=>{console.log(a)})};return(n,a)=>(Y(),te(ne,{needLog:!0},{header:k(()=>[ke]),menu:k(()=>[m("button",{class:"button A",onClick:h},"\u6E05\u7406\u6570\u636E"),Ce]),main:k(()=>[m("div",Le,[y(ue,{selected:c.value,"onUpdate:selected":a[1]||(a[1]=v=>c.value=v)},{default:k(()=>[y($,{key:"library",title:"\u56FE\u5E93"},{default:k(()=>[y(le,{ref_key:"galleryLoader",ref:b,value:i.value,"onUpdate:value":a[0]||(a[0]=v=>i.value=v),onLog:d},null,8,["value"])]),_:1}),y($,{key:"setting",title:"\u8BBE\u7F6E"},{default:k(()=>[y(ye,{value:o.value},null,8,["value"])]),_:1})]),_:1},8,["selected"]),m("div",Ee,[m("button",{class:"button large",onClick:t},"\u751F\u6210\u9884\u89C8"),m("button",{class:"button large C",onClick:a[2]||(a[2]=v=>s("gif"))},"\u4E0B\u8F7DGIF"),m("button",{class:"button large C",onClick:a[3]||(a[3]=v=>s("mp4"))},"\u4E0B\u8F7DMP4")])]),m("div",Pe,[m("img",{src:_.value,class:"previewImg"},null,8,Ie)])]),footer:k(()=>[y(he,{logs:w.value},null,8,["logs"])]),_:1}))}});var Ae=G(De,[["__scopeId","data-v-3e074d46"]]);se(Ae).mount("#app");
